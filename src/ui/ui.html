<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font: 12px sans-serif;
        text-align: center;
        margin: 20px;
        background-color: #1A1A1A;  /* Dark background */
        color: #FFFFFF;  /* White text */
      }
      button {
        border-radius: 5px;
        background: #333333;
        color: white;
        border: none;
        padding: 8px 15px;
        margin: 0 5px;
        box-shadow: inset 0 0 0 1px #666666;
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      button:hover {
        background: #444444;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      #create {
        box-shadow: none;
        background: #FFFFFF;
        color: #000000;
      }
      #create:hover {
        background: #E0E0E0;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        background: #2A2A2A;
      }
      .count {
        font-size: 24px;
        font-weight: bold;
        color: #FFFFFF;
        margin: 10px 0;
      }
      .dimension-info {
        text-align: left;
        padding: 10px;
        margin: 10px 0;
        background: #2A2A2A;
        border-radius: 5px;
      }
      .warning {
        color: #FFFFFF;
        font-weight: bold;
      }
      .success {
        color: #FFFFFF;
        font-weight: bold;
      }
      .info {
        color: #FFFFFF;
        font-weight: bold;
      }
      .group-list {
        margin: 10px 0;
        padding: 5px;
        max-height: 150px;
        overflow-y: auto;
        background: #333333;
        border-radius: 3px;
        border: 1px solid #444444;
      }
      .group-item {
        padding: 4px;
        border-bottom: 1px solid #444444;
      }
      .group-item:last-child {
        border-bottom: none;
      }
      .sprite-info {
        margin-top: 15px;
        padding: 10px;
        background: #2A2A2A;
        border-radius: 5px;
      }
      .progress-checklist {
        margin-top: 15px;
        padding: 10px;
        background: #2A2A2A;
        border-radius: 5px;
        text-align: left;
      }
      .checklist-item {
        margin: 5px 0;
        padding: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #CCCCCC;
      }
      .checklist-item.done {
        color: #FFFFFF;
      }
      .checklist-item:before {
        content: "◻️";
      }
      .checklist-item.done:before {
        content: "✓";
        color: #FFFFFF;
        font-weight: bold;
      }
      .input-group {
        margin: 15px 0;
        text-align: left;
        background: #2A2A2A;
        padding: 15px;
        border-radius: 5px;
      }
      .input-row {
        display: flex;
        align-items: center;
        margin: 8px 0;
        gap: 8px;
      }
      .input-row label {
        flex: 0 0 80px;
        color: #FFFFFF;
      }
      input[type="number"] {
        flex: 1;
        padding: 8px;
        border: 1px solid #444444;
        border-radius: 4px;
        width: 80px;
        background: #333333;
        color: #FFFFFF;
      }
      input[type="number"]:focus {
        outline: none;
        border-color: #FFFFFF;
      }
      .suggested-size {
        font-size: 11px;
        color: #CCCCCC;
        margin-top: 4px;
      }
      h2, h3 {
        color: #FFFFFF;
        margin-bottom: 15px;
      }
      /* Custom scrollbar for group list */
      .group-list::-webkit-scrollbar {
        width: 8px;
      }
      .group-list::-webkit-scrollbar-track {
        background: #1A1A1A;
        border-radius: 4px;
      }
      .group-list::-webkit-scrollbar-thumb {
        background: #444444;
        border-radius: 4px;
      }
      .group-list::-webkit-scrollbar-thumb:hover {
        background: #555555;
      }
      
      /* Button group styling */
      .button-group {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        width: 100%;
      }
      
      .button-group button {
        flex: 1;
        margin: 0;
        min-width: 0;
        white-space: nowrap;
      }
    </style>
  </head>
  <body>
    <h2>Sprite Sheet Maker</h2>
    <div class="status" id="selection-status">
      Select a frame to analyze
    </div>
    <div class="count" id="group-count"></div>
    <div class="dimension-info" id="dimension-info"></div>
    
    <div class="input-group">
      <h3>Container Size</h3>
      <div class="input-row">
        <label for="width">Width:</label>
        <input type="number" id="width" min="1" step="1" placeholder="Width" required>
        <span>px</span>
      </div>
      <div class="input-row">
        <label for="height">Height:</label>
        <input type="number" id="height" min="1" step="1" placeholder="Height" required>
        <span>px</span>
      </div>
      <div id="suggested-size" class="suggested-size"></div>
    </div>

    <div id="progress-checklist" class="progress-checklist" style="display: none;">
      <h3>Progress:</h3>
      <div id="checklist-items">
        <div class="checklist-item" id="check-parent">Configuring parent frame...</div>
        <div class="checklist-item" id="check-autolayout">Applying auto-layout...</div>
        <div class="checklist-item" id="check-frame">Creating sprite sheet frame...</div>
        <div class="checklist-item" id="check-complete">Setup complete!</div>
      </div>
    </div>

    <div class="button-group">
      <button id="refresh">Refresh Analysis</button>
      <button id="create" disabled>Create Sprite Sheet</button>
    </div>
    
    <script>
      const widthInput = document.getElementById('width');
      const heightInput = document.getElementById('height');
      const createButton = document.getElementById('create');

      function validateInputs() {
        const width = parseInt(widthInput.value);
        const height = parseInt(heightInput.value);
        const isValid = width > 0 && height > 0;
        createButton.disabled = !isValid;
        return isValid;
      }

      widthInput.addEventListener('input', validateInputs);
      heightInput.addEventListener('input', validateInputs);

      function formatDimensionInfo(analysis) {
        if (!analysis || !analysis.groups || analysis.groups.length === 0) {
          return '';
        }

        let html = '<h3>Group Dimensions:</h3>';
        
        if (analysis.allSameSize) {
          html += `<p class="success">✓ All groups are the same size: ${analysis.standardSize.width}x${analysis.standardSize.height}px</p>`;
        } else {
          html += '<p class="warning">⚠️ Groups have different sizes:</p>';
          html += '<div class="group-list">';
          analysis.groups.forEach(group => {
            html += `<div class="group-item">${group.name}: ${group.width}x${group.height}px</div>`;
          });
          html += '</div>';
        }

        html += `<p>${analysis.needsFormatting ? 
          '<span class="warning">Needs formatting: Groups should be the same size</span>' : 
          '<span class="success">No formatting needed</span>'}</p>`;

        // Update suggested size text
        if (analysis.maxDimension > 0) {
          document.getElementById('suggested-size').innerHTML = 
            `Suggested minimum size: ${analysis.maxDimension}x${analysis.maxDimension}px`;
          
          // Only set default values if inputs are empty
          if (!widthInput.value) widthInput.value = analysis.maxDimension;
          if (!heightInput.value) heightInput.value = analysis.maxDimension;
          validateInputs();
        }

        return html;
      }

      document.getElementById('refresh').onclick = () => {
        parent.postMessage({ pluginMessage: { type: 'count-groups' } }, '*')
      }
      
      document.getElementById('create').onclick = () => {
        if (!validateInputs()) {
          alert('Please enter valid dimensions (greater than 0)');
          return;
        }
        
        const width = parseInt(widthInput.value);
        const height = parseInt(heightInput.value);
        
        // Show progress checklist
        document.getElementById('progress-checklist').style.display = 'block';
        // Reset checklist
        document.querySelectorAll('.checklist-item').forEach(item => {
          item.classList.remove('done');
        });
        
        parent.postMessage({ 
          pluginMessage: { 
            type: 'create-sprite-sheet',
            width,
            height
          }
        }, '*');
      }

      // Listen for messages from the plugin code
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === 'selection-update') {
          document.getElementById('selection-status').textContent = msg.message;
          document.getElementById('group-count').textContent = msg.hasFrame 
            ? `Top-level groups: ${msg.groupCount}` 
            : '';
          document.getElementById('dimension-info').innerHTML = msg.hasFrame 
            ? formatDimensionInfo(msg.dimensionAnalysis)
            : '';
            
          // Reset inputs and disable create button when no valid frame is selected
          if (!msg.hasFrame) {
            widthInput.value = '';
            heightInput.value = '';
            createButton.disabled = true;
          }
        } else if (msg.type === 'progress-update') {
          // Update checklist
          const checkItem = document.getElementById('check-' + msg.step);
          if (checkItem) {
            checkItem.classList.add('done');
          }
        }
      }
    </script>
  </body>
</html> 